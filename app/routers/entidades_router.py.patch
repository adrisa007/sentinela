# Substituir a funÃ§Ã£o get_entidade_usuarios completa

@router.get(
    "/me/entidade/usuarios",
    summary="UsuÃ¡rios da Minha Entidade (GESTOR+)",
    description="ğŸ‘¥ Lista usuÃ¡rios da minha entidade.",
    dependencies=[Depends(require_active_entidade())]  # âœ… Aplicado aqui
)
async def get_entidade_usuarios(
    entidade: Entidade = Depends(get_current_entidade),
    current_user: CurrentUser = Depends(require_gestor)
):
    """
    ğŸ‘¥ **Listar UsuÃ¡rios da Minha Entidade**
    
    **ValidaÃ§Ãµes:**
    - âœ… Perfil GESTOR ou ROOT
    - âœ… Entidade ativa
    """
    from fastapi.responses import JSONResponse
    
    usuarios_data = [
        {
            "id": user.id,
            "username": user.username,
            "email": user.email,
            "role": user.role.value if hasattr(user.role, 'value') else str(user.role),
            "is_active": user.is_active
        }
        for user in entidade.usuarios
    ]
    
    return JSONResponse(content=usuarios_data)
